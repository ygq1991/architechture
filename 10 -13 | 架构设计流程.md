# 10 -13| 架构设计流程





## 一. 识别复杂度

将主要的复杂度列出来，根据业务，技术，团队等综合情况进行排序，优先解决当前面临的最主要的复杂度问题。



经验不足使用排查法



针对高性能，高可用，高扩展一一分析





## 二.设计备选方案





### 1. 现有技术

1. 架构师需要对现有的技术非常熟悉，熟悉优选点，适用场景
2. 熟悉已经验证过的架构模式
3. 根据业务挑选架构模式进行组合，再对方案进行调整和修改



已经经过验证的成熟技术：

* 高可用的主备方案
* 集群方案
* 高性能的负载方案
* 多路复用
* 可扩展的分层
* 插件化等技术





### 2. 创新新技术

当现有技术无法满足需求时，需要考虑方案的创新，大部分方案的创新基于已有的成熟技术



* NoSQL

  Key-Value的存储和数据库的索引类似，Memcache只是把数据库的索引独立出来做了一个缓存系统

* Hadoop

  大文件存储方案，基础其实是集群方案+数据复制方案

* Docker虚拟化

  基础是LXC （Linux Containers）

* LevelDB的文件存储结构是Skip List



### 3. 实战

架构的复杂度在于可选的方案和组合方式太多，

常见错误：

* 设计最优秀的方案

  需要根据合适原则和简单原则

* 只做一个方案

  * 心里评估过于简单，想的不够全面
  * 架构师自身的经验有限，可能评估标准或者经验不正确
  * 单一方案设计会出现过度辩护的情况
  * 备选方案过于详细，备选方案不等同于最终方案，
    * 耗费大量的时间和精力
    * 过于注意细节，忽视了整体的技术设计，导致备选方案数量不够或者差异不大
    * 评审的时候容易被细节绕进去，评审效果差

因此，架构设计需要做多个备选方案



合理的应该是：

* 备选方案已 3~5个最佳
* 方案之间差异要明显，例如主备和集群
* 备选方案的技术不要只局限于已经熟悉的技术













## 三.评估和选择备选方案



选择备选方案有几个指导思想

* 最简派
* 最牛派
* 最熟派
* 领导派





如何选择， 360度环评：

列出需要关注的质量属性点，然后分别从这些质量属性的维度去评估每个方案，再综合挑选最优方案。

常见的方案质量属性点有：

性能，可用性，硬件成本，项目投入，复杂性，安全性，可扩展性等。





面临选择上的困难有几种看似正确，实则错误的方案

* 数量对比方

  每种属性的重要程度不同，不能光看数量

* 加权法

  给每一个属性加上权重，问题在于如何分配权限，这个有很大的主观色彩，每个人的看法都不同



#### 正确的选择是按照优先级

根据当前的团队规模，业务发展情况等因素，将质量属性按照优先级排序，按照前面列出的复杂点选择方案



## 四.详细方案设计

经过第三步方案的确定，最后就要把确定方案的技术细节确定下来。

* 假如使用Elasticsearch做全文搜索，就需要确定索引按照业务划分还是一个大索引就够了。副本数量是几个，集群数量是几台
* 使用mysql分库分表，就要确定哪些表要分，按照什么维度分，分之后联合查询怎么处理
* 引入nginx做负载均衡，那么主备怎么做，策略用什么（轮询，随机，权重，ip_hash）





详细方案设计可能遇到的问题是：

备选方案不可行，主要原因是，遗漏了某个关键技术点或者关键的质量属性。



可以通过以下方式避免

* 除了对备选方案设计和选型，还需要对备选方案的细节有深入的理解
* 通过分步骤，分阶段，分系统等方式，尽量降低方案复杂度
* 如果方案很复杂，采用设计团队的方式，避免个人的思维和经验盲点